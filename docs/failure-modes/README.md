# 04 Failure Modes

Failure Modes 定义 iTrustCircle 系统在各种异常和故障情况下的行为策略，确保系统在真实使用环境中的可靠性和鲁棒性。

## 文档体系

### 主文档
- **[Failure Modes 清单](./failure-modes.md)**：详细的失败场景、检测方式、恢复策略

## 失败模式分类体系

### 网络与设备类（FM-N）
关注外部环境和技术基础设施相关的故障：
- **FM-N1**：无网络环境
- **FM-N2**：弱网/高延迟
- **FM-N3**：应用被系统杀死
- **FM-N4**：BLE 设备自身不稳定

### 数据一致性类（FM-D）
关注数据状态和一致性问题：
- **FM-D1**：本地草稿与已发送状态不一致
- **FM-D2**：重复发送导致重复事件
- **FM-D3**：Tower 端事件去重失败

### 用户与交互类（FM-U）
关注用户操作和交互相关问题：
- **FM-U1**：权限不足导致功能受限
- **FM-U2**：误报取消记录缺失
- **FM-U3**：配置信息不完整

## 失败模式处理原则

### 1. 可观测性优先
- 每个失败都必须能被检测和记录
- 提供清晰的错误信息和状态指示
- 支持诊断导出和问题排查

### 2. 用户友好性
- 错误信息用用户能理解的语言描述
- 提供明确的恢复指导和操作步骤
- 避免技术术语和错误码

### 3. 系统健壮性
- 核心功能不受 UI 层故障影响
- 关键数据不会因故障而丢失
- 支持自动恢复和手动干预

### 4. 渐进式降级
- 优先保证核心功能可用
- 在约束范围内提供替代方案
- 明确告知用户当前的限制

## 与其他文档的关系

### Failure Modes ↔ PRD
- PRD P1-P3 问题 → Failure Modes 具体场景
- PRD NFR 可靠性要求 → Failure Modes 恢复策略
- PRD 度量指标 M1-M5 → Failure Modes 验收标准

### Failure Modes ↔ 用户旅程
- 旅程 E 章失败模式 → Failure Modes 详细条目
- 旅程 D 章分支流程 → Failure Modes 触发条件
- 旅程 F 章验收点 → Failure Modes 验证方式

### Failure Modes ↔ ADR
- ADR 技术方案 → Failure Modes 实现基础
- ADR 风险评估 → Failure Modes 缓解策略
- ADR 验证方式 → Failure Modes 测试方法

### Failure Modes ↔ 验收文档
- Failure Modes 条目 → 故障恢复验收用例
- Failure Modes 验收方式 → 测试执行步骤
- Failure Modes 检测方式 → 监控和告警机制

## 质量保证框架

### 覆盖性检查
- ✅ 所有关键用户流程都有 Failure Modes 覆盖
- ✅ 所有关键技术组件都有故障处理
- ✅ 所有外部依赖都有失败应对策略

### 可测试性
- ✅ 每个 Failure Mode 都有明确的触发方式
- ✅ 每个恢复策略都有验证步骤
- ✅ 每个检测机制都有测试用例

### 可维护性
- ✅ Failure Mode 分类清晰，便于查找
- ✅ 处理策略文档化，便于知识传承
- ✅ 验收方式自动化，便于持续验证

## 验证流程

### 开发阶段验证
1. **实现前**：检查对应 Failure Mode 是否有处理方案
2. **实现中**：确保错误处理逻辑符合 Failure Mode 要求
3. **实现后**：运行对应的验收测试用例

### 测试阶段验证
1. **手动测试**：按照 Failure Mode 触发条件进行测试
2. **自动化测试**：基于 Failure Mode 验收方式编写测试
3. **压力测试**：模拟复杂故障场景

### 部署阶段验证
1. **监控检查**：确认 Failure Mode 检测机制正常工作
2. **告警测试**：验证故障告警和通知机制
3. **恢复演练**：测试故障恢复流程
