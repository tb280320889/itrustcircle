# 06 验收

验收文档定义 iTrustCircle 项目的可执行检查标准，确保从文档层到功能层的质量可控和可验证。

## 文档体系

### 主文档
- **[验收用例与检查清单](./acceptance.md)**：完整的验收标准和测试用例

## 验收层级架构

### Level 1：文档层验收
**目标**：确保文档架构的完整性和一致性
**范围**：docs/ 文件夹内所有文档
**标准**：文档检查 + 一致性验证

#### 检查项目
- **D-01**：docs/index.md 存在且链接可导航
- **D-02**：PRD 包含 Goals/Non-Goals/Scope/Requirements/NFR/Metrics
- **D-03**：三条旅程均包含 A-F 六章
- **D-04**：Failure Modes 包含网络、数据一致性、交互三类
- **D-05**：ADR 至少 8 条且索引包含状态与验证摘要

### Level 2：功能层验收
**目标**：确保功能实现的正确性和完整性
**范围**：具体功能模块和用户旅程
**标准**：AC 验收用例 + 端到端测试

#### 功能验收用例分类
- **AC-TO-XXX**：Tower 功能验收
- **AC-SE-XXX**：Sentinel 功能验收
- **AC-CO-XXX**：Contact 功能验收
- **AC-FM-XXX**：Failure Mode 验收

### Level 3：集成层验收
**目标**：确保系统集成的稳定性和可靠性
**范围**：跨角色协作和端到端流程
**标准**：集成测试 + 性能测试 + 安全测试

## 验收方法论

### 1. 可执行性原则
- 每个验收点都有明确的执行步骤
- 每个检查都有通过/失败的明确标准
- 支持自动化验证和持续集成

### 2. 可追溯性原则
- 每个验收点都能对应到 PRD 需求
- 每个用例都能对应到用户旅程步骤
- 每个故障场景都能对应到 Failure Mode

### 3. 渐进式验证原则
- 先文档层后功能层
- 先单元测试后集成测试
- 先功能验证后性能验证

## 验收与其他文档的关系

### 验收 ↔ PRD
- PRD 需求 → 验收用例 AC-TO/SE/CO
- PRD 度量指标 → 验收通过标准
- PRD 约束条件 → 验收前置条件

### 验收 ↔ 用户旅程
- 旅程 C 章步骤 → 端到端测试场景
- 旅程 F 章验收点 → 具体验收用例
- 旅程 E 章失败模式 → 故障恢复测试

### 验收 ↔ ADR
- ADR 决策 → 技术实现验收标准
- ADR 验证方式 → 验收执行步骤
- ADR 状态 → 验收优先级和时机

### 验收 ↔ Failure Modes
- Failure Mode 条目 → 故障恢复验收用例
- Failure Mode 验收方式 → 测试执行方法
- Failure Mode 检测方式 → 监控验收标准

## 验收执行流程

### 阶段 1：文档验收
```bash
# 文档完整性检查
pwsh -NoProfile -Command "Test-Path docs/index.md"
pwsh -NoProfile -Command "Select-String -Path docs/journeys/*.md -Pattern '^## [A-F]\.'"

# 工程健康检查
pnpm -C apps/mobile check
pnpm -C apps/mobile lint
pnpm -C apps/mobile test
```

### 阶段 2：单元验收
- AC-TO-001：Tower 接收与存档 AlertEvent
- AC-TO-002：Tower 通知投递与追踪
- AC-SE-001：BLE 断联触发倒计时
- AC-SE-002：AlertEvent 生成与上报
- AC-SE-003：离线队列与网络恢复补发

### 阶段 3：集成验收
- AC-CO-001：邮件通知内容完整性
- AC-CO-002：缺失信息的降级处理
- AC-FM-N1：Sentinel 无网离线队列
- AC-FM-N3：系统杀死应用恢复
- AC-FM-U1：权限不足阻断守护

## 质量度量指标

### 文档质量指标
- **完整性率**：应检查项 / 已检查项 = 100%
- **一致性率**：对齐项 / 总项数 = 100%
- **可执行性率**：可执行检查 / 总检查数 ≥ 95%

### 功能质量指标
- **验收通过率**：通过用例 / 总用例数 = 100%
- **代码覆盖率**：测试覆盖代码行数 / 总行数 ≥ 80%
- **缺陷密度**：缺陷数 / 千行代码 ≤ 1

### 系统质量指标
- **可用性**：系统正常运行时间 / 总时间 ≥ 99.9%
- **响应时间**：P95 响应时间 ≤ 2 秒
- **错误率**：错误请求数 / 总请求数 ≤ 0.1%
